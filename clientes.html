<!-- clientes.html corregido y funcional -->
<div class="modal-clientes">
  <h2>Registro de Cliente üêæ</h2>

  <!-- Campo de b√∫squeda tipo dropdown -->
  <div style="margin-bottom: 1em;">
    <label for="searchPet">Selecciona mascota registrada:</label>
    <select id="searchPet">
      <option value="">-- Buscar mascota existente --</option>
    </select>
  </div>

  <form id="form-clientes">
    <!-- Datos del Propietario -->
    <fieldset>
      <legend>Datos del Propietario</legend>
      <div class="grid-two-cols">
        <div class="form-group">
          <label for="ownerName">Nombre del propietario:</label>
          <input type="text" id="ownerName" name="ownerName" required />
        </div>
        <div class="form-group">
          <label for="ownerPhone">N√∫mero de Tel√©fono:</label>
          <input type="tel" id="ownerPhone" name="ownerPhone" required />
        </div>
        <div class="form-group">
          <label for="ownerEmail">Correo:</label>
          <input type="email" id="ownerEmail" name="ownerEmail" required />
        </div>
      </div>
    </fieldset>

    <!-- Datos de la Mascota -->
    <fieldset>
      <legend>Datos de la Mascota</legend>
      <div class="grid-two-cols">
        <div class="form-group">
          <label for="petName">Nombre de la mascota:</label>
          <input type="text" id="petName" name="petName" required />
        </div>
        <div class="form-group">
          <label for="pet-species">Especie:</label>
          <select id="pet-species" name="species" required>
            <option value="">-- Selecciona --</option>
            <option value="perro">Perro</option>
            <option value="gato">Gato</option>
            <option value="ave">Ave</option>
            <option value="tortuga">Tortuga</option>
            <option value="serpiente">Serpiente</option>
            <option value="lagarto">Lagarto</option>
            <option value="pez">Pez</option>
            <option value="roedor">Roedor</option>
          </select>
        </div>
        <div class="form-group">
          <label for="breed">Raza:</label>
          <select id="breed" name="breed" required>
            <option value="">-- Selecciona especie primero --</option>
          </select>
          <input type="text" id="breed-other" placeholder="Especificar otra raza" style="display:none; margin-top:5px;" />
        </div>
        <div class="form-group">
          <label for="age">Edad (a√±os.decimales):</label>
          <input type="number" id="age" name="age" step="0.1" min="0" />
        </div>
        <div class="form-group">
          <label for="weight">Peso (kg.decimales):</label>
          <input type="number" id="weight" name="weight" step="0.01" min="0" />
        </div>
        <div class="form-group">
          <label>¬øEst√° esterilizado?</label>
          <div class="radio-group">
            <label><input type="radio" name="sterilized" value="si" /> S√≠</label>
            <label><input type="radio" name="sterilized" value="no" /> No</label>
          </div>
        </div>
      </div>

      <!-- Observaciones -->
      <div class="form-group">
        <label for="observations">Observaciones:</label>
        <textarea id="observations" name="observations" rows="2"></textarea>
      </div>

      <!-- Diagrama Corporal con hotspots -->
      <div id="cliente-diagrama" class="diagrama-container">
        <img id="diagrama-img" src="svg/placeholder.png" alt="Diagrama mascota" />
      </div>
    </fieldset>

    <button type="submit" class="button-86" id="btnGuardarCliente">Guardar Cliente</button>
  </form>
</div>

<style>
.modal-clientes {
  background: white;
  padding: 1em;
  border-radius: 12px;
  width: 90%;
  max-width: 900px;
  position: relative;
  overflow-y: auto;
  max-height: 95vh;
}
.modal-content {
  width: 90%;
  max-width: 900px;
}
.diagrama-container img {
  max-width: 100%;
  margin-top: 1em;
  border: 1px solid #ccc;
  border-radius: 8px;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const especiesRazas = {
    perro: ['Criollo', 'Bulldog', 'Chihuahua', 'Pastor Alem√°n', 'Labrador', 'Pug', 'Golden Retriever', 'Beagle', 'Pitbull', 'Otro'],
    gato: ['Criollo', 'Persa', 'Siam√©s', 'Maine Coon', 'Bengala', 'Azul Ruso', 'Sphynx', 'Brit√°nico', 'Scottish Fold', 'Otro'],
    ave: ['Canario', 'Periquito', 'Cotorra', 'Loro', 'Agapornis', 'Guacamayo', 'Calopsita', 'Otro'],
    tortuga: ['Orejas Rojas', 'Caja', 'Leopardo', 'Sulcata', 'Rusa', 'De Tierra', 'De Agua', 'Otro'],
    serpiente: ['Pit√≥n Bola', 'Boa', 'Ma√≠z', 'Rey', 'De Leche', 'Otro'],
    lagarto: ['Iguana', 'Gecko', 'Drag√≥n Barbudo', 'Otro'],
    pez: ['Betta', 'Goldfish', 'Guppy', 'Platy', 'Otro'],
    roedor: ['H√°mster', 'Cuy', 'Rat√≥n', 'Rata', 'Conejo', 'Otro']
  };

  const clientes = await loadAllClients();
  const searchPet = document.getElementById("searchPet");
  clientes.forEach(cliente => {
    if (cliente["Nombre de la mascota"]) {
      const opt = document.createElement("option");
      opt.value = cliente["ID fila"] || cliente["ID cliente"] || cliente["Nombre de la mascota"];
      opt.textContent = `${cliente["Nombre de la mascota"]} (${cliente["Nombre del propietario"]})`;
      searchPet.appendChild(opt);
    }
  });

  searchPet.addEventListener("change", () => {
    const selected = clientes.find(c => c["ID fila"] == searchPet.value || c["ID cliente"] == searchPet.value);
    if (!selected) return;

    document.getElementById("ownerName").value = selected["Nombre del propietario"] || "";
    document.getElementById("ownerPhone").value = selected["N√∫mero de Tel√©fono"] || "";
    document.getElementById("ownerEmail").value = selected["Correo"] || "";
    document.getElementById("petName").value = selected["Nombre de la mascota"] || "";
    document.getElementById("pet-species").value = selected["Especie"] || "";
    document.getElementById("age").value = selected["Edad"] || "";
    document.getElementById("weight").value = selected["Peso"] || "";
    document.getElementById("observations").value = selected["Observaciones"] || "";

    const est = (selected["Esterilizado"] || "").toLowerCase();
    document.querySelector(`input[name="sterilized"][value="${est === 's√≠' || est === 'si' ? 'si' : 'no'}"]`).checked = true;

    actualizarRazas(selected["Especie"] || "");
    document.getElementById("breed").value = selected["Raza"] || "";
    cargarDiagramaCliente();
  });

  document.getElementById("pet-species").addEventListener("change", function() {
    actualizarRazas(this.value);
    cargarDiagramaCliente();
  });

  function actualizarRazas(especie) {
    const razaSelect = document.getElementById("breed");
    razaSelect.innerHTML = '<option value="">-- Selecciona --</option>';
    if (!especie || !especiesRazas[especie]) return;
    especiesRazas[especie].forEach(r => {
      const opt = document.createElement("option");
      opt.value = r;
      opt.textContent = r;
      razaSelect.appendChild(opt);
    });
    razaSelect.addEventListener("change", () => {
      const input = document.getElementById("breed-other");
      if (razaSelect.value === "Otro") {
        input.style.display = "block";
      } else {
        input.style.display = "none";
      }
    });
  }

  function cargarDiagramaCliente() {
    const especie = document.getElementById("pet-species").value;
    const mapaImagen = {
      perro: 'svg/perro.png',
      gato: 'svg/felino.svg',
      ave: 'svg/ave.png',
      tortuga: 'svg/tortuga.svg',
      serpiente: 'svg/serpiente.svg',
      lagarto: 'svg/lagarto.png',
      pez: 'svg/pez.svg',
      roedor: 'svg/roedor.svg'
    };
    document.getElementById("diagrama-img").src = mapaImagen[especie] || 'svg/placeholder.png';
  }
});
</script>
